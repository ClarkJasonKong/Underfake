<html>
<body>

<canvas id= "Underfake" width="900" height="900" input type="text" onkeydown="function(event)" onkeyup="function(event)"  onmousedown="function(event)" ></canvas>
<script>

var canvas = document.getElementById("Underfake")
var context = canvas.getContext("2d")

var screenWidth = 900
var screenHeight = 900
var boxWidth = 50
var boxHeight = 50

var posX
var posY
var moveUp
var moveDown
var moveLeft
var moveRight
var moveSpace

var maxRpr = 2
var minRpr = 0
var rainDropsX = new Array()
var rainDropsY = new Array()

document.onkeydown = keyDown;
document.onkeyup = keyUp

gameInit()


function gameInit(){
	posX = 0
	posY = screenHeight-boxHeight
	moveSpace = 10
	isRed = true
	gameLoop()
}
function addRain(){
	for( var i = 0; i< Math.floor((Math.random() * maxRpr) + minRpr); i++){
		rainDropsX.push(Math.floor(Math.random() * screenWidth))
		rainDropsY.push(0)
	}
}
function gameLoop(){
	gameUpdate()
	addRain()
	drawRain()
	drawPlayer()
	setTimeout(gameLoop, 10)
}
function keyDown(event){
	//console.log(event.keyCode);

	if(event.keyCode == 37){
		moveLeft = true
	}
	else if (event.keyCode == 39){
		moveRight = true
	}
	else if (event.keyCode == 38){
		moveUp = true
	}
	else if (event.keyCode==40 ){
		moveDown = true
	}
}

function keyUp(event){
	//console.log(event.keyCode);

	if(event.keyCode == 37){
		moveLeft = false
	}
	else if (event.keyCode == 39){
		moveRight = false
	}
	else if (event.keyCode == 38){
		moveUp = false
	}
	else if (event.keyCode ==40){
		moveDown = false
	}
	if(event.keyCode == 81){
		isRed = true
		isBlue = false
		isYellow = false
		isGreen = false
	}
	if(event.keyCode == 87){
		isRed = false
		isBlue = true
		isYellow = false
		isGreen = false
	}
	if(event.keyCode == 69){
		isRed = false
		isBlue = false
		isYellow = true
		isGreen = false
	}
	if(event.keyCode == 82){
		isRed = false
		isBlue = false
		isYellow = false
		isGreen = true
	}
}

function gameUpdate(){
	yLen = rainDropsY.length
	for(var i = 0; i < yLen ; i++){
		rainDropsY[i]+=10;
	}


	if (isRed){
		moveSpace = 10
		boxWidth = 20
		boxHeight = 20
	}
	else if (isBlue){
		moveSpace = 5
		boxWidth = 40
		boxHeight = 40
	}
	else if (isYellow){
		moveSpace = 5
		boxWidth = 40
		boxHeight = 40
	}
	else if (isGreen){
		moveSpace = 5
		boxWidth = 40
		boxHeight = 40
	}
	if(moveLeft && posX > 0){
	   posX -= moveSpace
	}
	if(moveRight && posX < screenWidth - boxWidth){
	   posX += moveSpace
	}
	if(moveUp && posY > 0 ){
	   posY -= moveSpace 
	}
	if(moveDown && posY < screenHeight - boxHeight){
	   posY += moveSpace
	}
}
function drawPlayer(){
	if (isRed)
		context.fillStyle = "red"
	else if (isBlue)
		context.fillStyle = "blue"
	else if (isYellow)
		context.fillStyle = "yellow"
	else if (isGreen)
		context.fillStyle = "green"
	context.fillRect(posX, posY, boxWidth, boxHeight)
}
function drawRain(){
	drawBG()
	for(var i=0; i< rainDropsY.length ; i++){
		context.fillStyle = "blue"
		context.fillRect(rainDropsX[i], rainDropsY[i], 10, 10)
	}

}
function drawBG(){
	context.fillStyle = "black"
	context.fillRect(0, 0, screenWidth, screenHeight)
}

</script>

</body>
</html>